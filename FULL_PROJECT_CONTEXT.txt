### STRUKTURA PROJEKTA ###
cv builder/
    index.html
    package.json
    tailwind.config.js
    vercel.json
    api/
        main.py
        templates/
            cv_template.html
    static/
        manifest.json
        sw.js
        css/
            style.css
            tailwind-output.css
        js/
            api.js
            auth.js
            dossier.js
            main.js

==================================================

START OF FILE: index.html
--------------------
<!DOCTYPE html>
<html lang="sr" class="light">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#111827">
    <title>CVespresso | Powered by Bojan Pejiƒá</title>
    <link rel="manifest" href="/manifest.json">
    
    <!-- ‚úÖ POPRAVLJENO: Uklonjeni razmaci u URL-ovima -->
    <link href="https://fonts.googleapis.com/css2?family=Satisfy&family=Geist:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/static/css/tailwind-output.css">
    <link rel="stylesheet" href="/static/css/tailwind-output.css?v=2.0">
    <link rel="stylesheet" href="/static/css/tailwind-output.css?v=3.0">
    <!-- ‚úÖ POPRAVLJENO: Uklonjeni razmaci -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.google.com/recaptcha/api.js?render=TVOJ_SITE_KEY"></script>
    
    <!-- ‚úÖ DODATO: Inline stil za fallback tekst boju -->
    <style>
        /* Fallback za --text varijablu ako nije definisana */
        :root { --text: oklch(0.14 0 0); }
        .dark { --text: oklch(0.99 0 0); }
        body { color: var(--text, var(--border-hover)); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6 font-sans transition-all duration-500 bg-[var(--bg)] text-[var(--text)]">
    <div id="sideDrawer" class="fixed top-0 left-0 h-full w-80 bg-[var(--bg)] border-r border-[var(--border)] z-[110] transform -translate-x-full transition-transform duration-500 ease-in-out flex flex-col shadow-2xl">
        
        <div class="p-6 flex justify-between items-center border-b border-[var(--border)]">
            <h2 class="text-xs font-black uppercase tracking-widest opacity-50">Tvoj Arhiv</h2>
            <button id="btnCloseMenu" class="opacity-40 hover:opacity-100 text-xl text-[var(--border-hover)]">&times;</button>
        </div>

        <div class="p-6 border-b border-[var(--border)]">
            <button id="drawerOpenDossier" class="btn-espresso w-full py-3 rounded-lg text-[10px] font-bold uppercase tracking-[0.2em] flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                Master Dossier
            </button>
        </div>

        <div class="flex-1 overflow-y-auto p-6 space-y-4" id="applicationsList">
            <div class="text-center opacity-20 text-[10px] uppercase font-bold tracking-widest mt-10">
                Nema saƒçuvanih CV-jeva
            </div>
            
            </div>
        
        <div class="p-4 border-t border-[var(--border)] text-center">
            <span class="text-[9px] font-bold uppercase tracking-widest opacity-30" id="usageLimitText">Iskori≈°ƒáeno: 0 / 50</span>
        </div>
    </div>

    <div id="drawerBackdrop" class="fixed inset-0 bg-black/50 z-[105] hidden transition-opacity duration-500 opacity-0"></div>

    <div id="authBar" class="fixed top-4 right-6 z-[100] flex gap-4">
        <button id="btnLogin" onclick="loginWithGoogle()" class="text-[9px] font-black uppercase tracking-[0.3em] opacity-40 hover:opacity-100 transition-all bg-[var(--bg)] p-2 rounded border border-[var(--border)]">
            [ Sign in with Google ]
        </button>
        <button id="btnLogout" onclick="logout()" class="hidden text-[9px] font-black uppercase tracking-[0.3em] text-red-500 hover:opacity-100 transition-all bg-[var(--bg)] p-2 rounded border border-red-900/20">
            [ Logout ]
        </button>
    </div>

    <header class="w-full max-w-2xl flex justify-between items-center mb-16 mt-12">
        <div class="flex items-center gap-4">
            <button id="btnMenu" class="focus:outline-none opacity-40 hover:opacity-100 transition-opacity">
                <svg class="w-6 h-6 stroke-[var(--border-hover)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            
            <div class="flex items-baseline gap-1 select-none">
                <span class="text-2xl font-bold tracking-tighter uppercase">CV</span>
                <span class="text-3xl font-cursive">espresso</span>
            </div>
        </div>
        <div class="flex items-center gap-8">
            <button id="btnHelp" class="text-[10px] font-bold tracking-[0.2em] uppercase opacity-40 hover:opacity-100 transition-opacity">
                [ Info ]
            </button>

            <button id="langBtn" class="text-xs font-bold tracking-[0.2em] uppercase opacity-40 hover:opacity-100 transition-opacity">
                sr
            </button>
            <button id="themeToggle" class="focus:outline-none">
                <svg id="sunIcon" class="icon-toggle hidden w-5 h-5" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg id="moonIcon" class="icon-toggle w-5 h-5" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
    </header>

    <main class="w-full max-w-2xl space-y-10">
        

        <textarea id="jobDesc" rows="12" 
            class="w-full p-6 rounded-xl transition-all resize-none placeholder:opacity-20 shadow-inner bg-transparent border border-[var(--border)]" 
            placeholder="Paste your job specs..."></textarea>

        <div class="grid grid-cols-2 gap-4">
            <button id="btnCV" class="btn-espresso py-4 rounded-lg text-[10px] font-bold uppercase tracking-[0.3em]">
                Build CV
            </button>
            <button id="btnCL" class="btn-espresso py-4 rounded-lg text-[10px] font-bold uppercase tracking-[0.3em]">
                Letter
            </button>
        </div>
    </main>

    <!-- ‚úÖ Editor je hidden by default - dobro! -->
    <div id="dossierEditor" class="hidden fixed inset-0 z-50 bg-[var(--bg)] p-6 md:p-20 overflow-y-auto transition-all duration-500">
        <div class="max-w-2xl mx-auto">
            <header class="flex justify-between items-center mb-12 border-b border-[var(--border)] pb-6">
                <h2 class="text-xl font-bold uppercase tracking-widest">Master <span class="font-cursive lowercase">dossier</span></h2>
                <button onclick="document.getElementById('dossierEditor').classList.add('hidden')" class="opacity-40 hover:opacity-100 font-bold text-[10px] uppercase tracking-widest">[ Zatvori ]</button>
            </header>
            
            <div id="formContainer" class="space-y-8 pb-20"></div>
        </div>
    </div>

    <div id="helpModal" class="fixed inset-0 z-[120] flex items-center justify-center hidden">
        <div id="helpBackdrop" class="absolute inset-0 bg-black/50 transition-opacity duration-300 opacity-0"></div>
        
        <div id="helpContent" class="relative bg-[var(--bg)] border border-[var(--border)] rounded-2xl p-8 max-w-lg w-full mx-4 shadow-2xl transform scale-95 opacity-0 transition-all duration-300">
            <div class="flex justify-between items-center mb-6 border-b border-[var(--border)] pb-4">
                <h3 class="text-sm font-black uppercase tracking-widest text-[var(--border-hover)]" id="helpTitle">Kako se koristi?</h3>
                <button id="btnCloseHelp" class="text-2xl font-bold opacity-40 hover:opacity-100">&times;</button>
            </div>
            
            <div class="space-y-4 text-sm opacity-80" id="helpTextSr">
                <p><strong>1. Va≈° Profil:</strong> Otvorite meni (gore levo) i popunite <em>Master Dossier</em>. Tu unosite sve va≈°e ve≈°tine, obrazovanje i celokupno radno iskustvo.</p>
                <p><strong>2. Oglas za posao:</strong> Prona≈°li ste posao? Prekopirajte ceo tekst tog oglasa u veliko polje na sredini ekrana.</p>
                <p><strong>3. Magija:</strong> Kliknite na <strong>Build CV</strong> ili <strong>Letter</strong>. AI ƒáe analizirati oglas, izvuƒái samo ono ≈°to je bitno iz va≈°eg dosijea i skrojiti vam savr≈°en PDF dokument.</p>
                <p><strong>4. Arhiva:</strong> Svaki dokument se automatski ƒçuva u fioci (limit je 50 aplikacija).</p>
            </div>

            <div class="space-y-4 text-sm opacity-80 hidden" id="helpTextEn">
                <p><strong>1. Your Profile:</strong> Open the menu (top left) and fill out your <em>Master Dossier</em>. Enter all your skills, education, and full work history here.</p>
                <p><strong>2. Job Spec:</strong> Found a job? Paste the text of the job description you are applying for into the main text area.</p>
                <p><strong>3. The Magic:</strong> Click <strong>Build CV</strong> or <strong>Letter</strong>. The AI will analyze the job, extract the most relevant info from your Dossier, and generate a tailored PDF document.</p>
                <p><strong>4. Archive:</strong> Every generated document is automatically saved in your drawer (limit is 50 applications).</p>
            </div>
        </div>
    </div>

    <div id="pdfModal" class="fixed inset-0 z-[150] flex flex-col items-center justify-center hidden">
        <div id="pdfBackdrop" class="absolute inset-0 bg-black/80 transition-opacity"></div>
        
        <div class="relative w-full max-w-4xl h-[90vh] bg-[var(--bg)] border border-[var(--border)] rounded-2xl shadow-2xl flex flex-col overflow-hidden m-4 z-10">
            <div class="flex justify-between items-center p-4 border-b border-[var(--border)] bg-[var(--bg)]">
                <h3 class="text-xs font-black uppercase tracking-widest opacity-50" id="pdfTitle">Pregled Dokumenta</h3>
                <div class="flex gap-4">
                    <button id="btnDownloadPdf" class="btn-espresso px-4 py-2 rounded text-[10px] font-bold uppercase tracking-widest border border-green-500/50 hover:bg-green-500/10 text-green-500">
                        ‚Üì Preuzmi PDF
                    </button>
                    <button id="btnClosePdf" class="text-2xl font-bold opacity-40 hover:opacity-100 px-2">&times;</button>
                </div>
            </div>
            <iframe id="pdfFrame" class="w-full flex-1 bg-white"></iframe>
        </div>
    </div>

    <footer class="mt-auto py-12 text-[8px] font-bold uppercase tracking-[0.6em] select-none text-center w-full opacity-30">
        Bojan Pejiƒá &copy; 2026 | Head of Production
    </footer>

    <!-- ‚úÖ SKRIPTE NA KRAJU - PRAVILAN REDOSLED -->
    <script src="/static/js/main.js?v=5"></script>
    <script src="/static/js/dossier.js?v=5"></script>
    <script src="/static/js/api.js?v=5"></script>
    <script src="/static/js/auth.js?v=5"></script>
    
    <!-- ‚úÖ DODATO: Debug log za potvrdu da je sve uƒçitano -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("=== ‚úÖ INDEX.HTML FULLY LOADED ===");
            console.log("üîò openDossier btn:", document.getElementById('openDossier') ? "OK" : "MISSING");
            console.log("üìù dossierEditor:", document.getElementById('dossierEditor')?.classList.contains('hidden') ? "HIDDEN (good!)" : "VISIBLE (bad!)");
        });
    </script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js').then(reg => {
                console.log('PWA Service Worker registrovan!', reg);
            }).catch(err => {
                console.log('PWA Service Worker gre≈°ka:', err);
            });
            });
        }
    </script>
</body>
</html>
--------------------
END OF FILE: index.html

START OF FILE: package.json
--------------------
{
  "name": "cv-builder",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "type": "commonjs",
  "devDependencies": {
    "tailwindcss": "^4.2.1"
  },
  "dependencies": {
    "@tailwindcss/cli": "^4.2.1"
  }
}

--------------------
END OF FILE: package.json

START OF FILE: tailwind.config.js
--------------------
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./index.html",
    "./static/js/**/*.js",
    "./api/templates/**/*.html"
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
--------------------
END OF FILE: tailwind.config.js

START OF FILE: vercel.json
--------------------
{
  "version": 2,
  "builds": [
    {
      "src": "api/main.py",
      "use": "@vercel/python"
    },
    {
      "src": "static/**",
      "use": "@vercel/static"
    }
  ],
  "routes": [
    {
      "src": "/static/(.*)",
      "dest": "/static/$1"
    },
    {
      "src": "/(.*)",
      "dest": "api/main.py"
    }
  ]
}
--------------------
END OF FILE: vercel.json

START OF FILE: api\main.py
--------------------
import os
import json
import re
import uuid       
import tempfile   
from dotenv import load_dotenv
from fastapi import FastAPI, HTTPException, Query, Request, BackgroundTasks
from fastapi.responses import FileResponse, HTMLResponse
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
from pydantic import BaseModel
from groq import Groq
from fpdf import FPDF

# --- NOVI IMPORTI ZA SLOWAPI ---
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

# Uƒçitavanje eksternih konfiguracija (.env fajl)
load_dotenv()

# --- INICIJALIZACIJA LIMITERA ---
limiter = Limiter(key_func=get_remote_address)
app = FastAPI(title="CVespresso API")

# Povezivanje limitera sa FastAPI aplikacijom i definisanje hendlera za gre≈°ku
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

# --- DINAMIƒåKO PODE≈†AVANJE PUTANJA ---
current_dir = os.path.dirname(os.path.realpath(__file__))
root_dir = os.path.dirname(current_dir)

# Montiranje statiƒçkih fajlova
app.mount("/static", StaticFiles(directory=os.path.join(root_dir, "static")), name="static")

# Pode≈°avanje Jinja2 ≈°ablona
templates = Jinja2Templates(directory=[root_dir, os.path.join(current_dir, "templates")])

# Putanja do fonta
FONT_PATH = os.path.join(current_dir, "arial.ttf")

# --- API KLIJENT ---
api_key = os.getenv("GROQ_API_KEY")
client = Groq(api_key=api_key)

# --- POMOƒÜNE FUNKCIJE ---
def sanitize_input(text: str) -> str:
    """Uklanja HTML tagove radi spreƒçavanja XSS napada."""
    if not text:
        return ""
    clean = re.compile('<.*?>')
    return re.sub(clean, '', text).strip()

def sanitize_dossier(dossier: dict) -> dict:
    """Rekurzivno ƒçisti sve tekstualne unose u dosijeu."""
    if isinstance(dossier, dict):
        return {k: sanitize_dossier(v) for k, v in dossier.items()}
    elif isinstance(dossier, list):
        return [sanitize_dossier(i) for i in dossier]
    elif isinstance(dossier, str):
        return sanitize_input(dossier)
    return dossier

def remove_temp_file(path: str):
    """Brisanje fajla u pozadini nakon slanja korisniku radi u≈°tede prostora."""
    try:
        if os.path.exists(path):
            os.remove(path)
    except Exception as e:
        print(f"Gre≈°ka pri brisanju temp fajla: {e}")

def create_pdf_header(pdf: FPDF, profile_data: dict):
    """Zajedniƒçka funkcija za iscrtavanje profesionalnog zaglavlja na CV-ju i Pismu"""
    pdf.set_font('ArialUni', size=20)
    pdf.set_text_color(26, 28, 30)
    pdf.cell(0, 10, profile_data.get("full_name", "CVespresso User"), ln=True, align='L')
    
    # --- KONTAKT INFORMACIJE (Email, Telefon, Lokacija) ---
    pdf.set_font('ArialUni', size=9)
    pdf.set_text_color(100, 100, 100)
    
    contact_info = []
    if profile_data.get("email"): contact_info.append(profile_data.get("email"))
    if profile_data.get("phone"): contact_info.append(profile_data.get("phone"))
    if profile_data.get("location"): contact_info.append(profile_data.get("location"))
    
    if contact_info:
        pdf.cell(0, 5, " | ".join(contact_info), ln=True, align='L')

    # --- SOCIJALNE MRE≈ΩE I PORTFOLIO ---
    links = []
    if profile_data.get("linkedin"): 
        clean_in = profile_data.get("linkedin").replace("https://", "").replace("http://", "").rstrip('/')
        links.append(f"LinkedIn: {clean_in}")
    if profile_data.get("github"): 
        clean_git = profile_data.get("github").replace("https://", "").replace("http://", "").rstrip('/')
        links.append(f"GitHub: {clean_git}")
    if profile_data.get("website"): 
        clean_web = profile_data.get("website").replace("https://", "").replace("http://", "").rstrip('/')
        links.append(f"Web: {clean_web}")
        
    if links:
        pdf.cell(0, 5, " | ".join(links), ln=True, align='L')
    
    # Linija razdvajanja ispod zaglavlja
    pdf.set_draw_color(200, 200, 200)
    current_y = pdf.get_y() + 3
    pdf.line(10, current_y, 200, current_y)
    pdf.ln(8)

    # Prebacivanje na glavnu crnu boju za ostatak teksta
    pdf.set_text_color(0, 0, 0)
    pdf.set_font('ArialUni', size=11)


# Model podataka
class FullDossierRequest(BaseModel):
    job_description: str
    user_dossier: dict = None 

# Anonimni default profil radi za≈°tite privatnosti
DEFAULT_MASTER_DOSSIER = {
    "full_name": "Korisnik Aplikacije",
    "title": "Profesionalac",
    "experience": "Primer radnog iskustva koji AI treba da prilagodi.",
    "projects": [],
    "certifications": []
}

# --- RUTE ---

@app.get("/", response_class=HTMLResponse)
async def read_index(request: Request):
    """Servira glavni UI aplikacije"""
    try:
        return templates.TemplateResponse("index.html", {"request": request})
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Template Error: {str(e)}")

@app.post("/generate-pdf/")
@limiter.limit("5/minute") 
async def generate_pdf(request: Request, dossier_req: FullDossierRequest, background_tasks: BackgroundTasks, lang: str = Query("sr", enum=["sr", "en"])):
    """Generi≈°e PDF CV na osnovu Master JSON-a i oglasa"""
    
    clean_job_desc = sanitize_input(dossier_req.job_description)
    profile_data = sanitize_dossier(dossier_req.user_dossier) if dossier_req.user_dossier else DEFAULT_MASTER_DOSSIER
    
    # ensure_ascii=False osigurava da AI model pravilno vidi na≈°a slova (≈°, ƒë, ≈æ, ƒá, ƒç)
    json_dossier = json.dumps(profile_data, ensure_ascii=False)
    
    if lang == "sr":
        sys_msg = """Ti si in≈æenjer za optimizaciju CV-ja (ATS sistemi).
        TVOJ JEDINI ZADATAK JE DA PREFORMULI≈†E≈† SADR≈ΩAJ I STROGO GA UPAKUJE≈† U ZADATI ≈†ABLON.
        STROGA PRAVILA:
        1. KREATIVNOST U STRUKTURI JE ZABRANJENA.
        2. BEZ KONTAKT PODATAKA (ime, email, telefon).
        3. ISKLJUƒåIVO EKAVICA. Nema ijekavice.
        4. Rezime pi≈°i u skrivenom prvom licu."""
        
        user_prompt = f"""
        Dosije: {json_dossier}
        Oglas: {clean_job_desc}
        
        ZADATAK:
        Preformuli≈°i radno iskustvo i rezime. Ispi≈°i sadr≈æaj STROGO koristeƒái ovaj format:

        PROFESIONALNI REZIME
        [Sna≈æan rezime u 3 reƒçenice prilagoƒëen oglasu]

        VE≈†TINE
        [Lista kljuƒçnih ve≈°tina odvojenih zarezima, izvuƒçenih iz dosijea]

        RADNO ISKUSTVO
        [Pozicija iz dosijea] | [Kompanija iz dosijea] | [Period iz dosijea]
        ‚Ä¢ [Akcioni bullet poen prilagoƒëen oglasu]
        ‚Ä¢ [Akcioni bullet poen prilagoƒëen oglasu]
        
        VA≈ΩNO ZA ISKUSTVO: MORA≈† navesti SVA radna iskustva iz dosijea kako bi se saƒçuvao hronolo≈°ki red! Za relevantne poslove napi≈°i 2-3 bullet poena. Za starije ili nerelevantne poslove ispi≈°i SAMO naslovnu liniju (Pozicija | Firma | Period) i izostavi bullet poene.

        OBRAZOVANJE
        ‚Ä¢ [Stepen obrazovanja/Diploma], [≈†kola] ([Godina])

        SERTIFIKATI
        ‚Ä¢ [Naziv sertifikata] ([Godina])
        """
    else:
        sys_msg = """You are an elite ATS-Optimization Engineer.
        YOUR ONLY JOB IS TO TRANSLATE, TAILOR THE CONTENT, AND STRICTLY PACK IT INTO THE TEMPLATE.
        STRICT RULES:
        1. TRANSLATE EVERYTHING TO ENGLISH (Job titles, skills, degrees, etc.).
        2. STRUCTURAL CREATIVITY IS FORBIDDEN.
        3. NO CONTACT INFO.
        4. First-person professional summary."""
        
        user_prompt = f"""
        Dossier: {json_dossier}
        Job: {clean_job_desc}
        
        TASK:
        Translate the dossier to English and tailor the candidate's experience. Output the result STRICTLY using the exact format below (copy ALL-CAPS headers):

        PROFESSIONAL SUMMARY
        [3 impactful sentences tailored to the job in English]

        SKILLS
        [Comma-separated list of translated, relevant skills in English]

        WORK EXPERIENCE
        [Translated Job Title] | [Company] | [Period]
        ‚Ä¢ [Action-oriented bullet point targeting JD keywords in English]
        ‚Ä¢ [Action-oriented bullet point targeting JD keywords in English]

        CRITICAL FOR EXPERIENCE: You MUST list EVERY job from the dossier to keep the chronological timeline intact. Do not skip any jobs! For relevant roles, provide 2-3 tailored bullets. For older or irrelevant roles, just list the Title, Company, and Period with NO bullets.

        EDUCATION
        ‚Ä¢ [Translated Degree], [School] ([Year])

        CERTIFICATIONS
        ‚Ä¢ [Translated Certificate Name] ([Year])
        """

    try:
        completion = client.chat.completions.create(
            model="llama-3.3-70b-versatile",
            messages=[
                {"role": "system", "content": sys_msg},
                {"role": "user", "content": user_prompt}
            ],
            temperature=0.2
        )
        tailored_text = completion.choices[0].message.content
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"AI Error: {str(e)}")

    try:
        pdf = FPDF()
        pdf.add_page()
        
        if not os.path.exists(FONT_PATH):
            raise FileNotFoundError(f"Font nije pronaƒëen na putanji: {FONT_PATH}")
            
        pdf.add_font('ArialUni', '', FONT_PATH, uni=True)
        
        # Generi≈°i zaglavlje
        create_pdf_header(pdf, profile_data)
        
        # --- NOVI RENDERER (Estetika i ATS forma) ---
        clean_pdf_text = tailored_text.replace('#', '').replace('**', '').replace('* ', '‚Ä¢ ')
        
        # Kljuƒçne reƒçi koje okidaju crtanje naslova i linija
        headers = [
            "PROFESIONALNI REZIME", "VE≈†TINE", "RADNO ISKUSTVO", "OBRAZOVANJE", "SERTIFIKATI",
            "PROFESSIONAL SUMMARY", "SKILLS", "WORK EXPERIENCE", "EDUCATION", "CERTIFICATIONS"
        ]

        for line in clean_pdf_text.split('\n'):
            line = line.strip()
            if not line:
                pdf.ln(2) # Mali razmak za prazne redove
                continue
            
            upper_line = line.upper()
            
            # 1. AKO JE NASLOV SEKCIJE
            if any(h in upper_line for h in headers) and len(line) < 30:
                pdf.ln(6)
                pdf.set_font('ArialUni', size=11)
                pdf.set_text_color(0, 0, 0) # Crna
                pdf.cell(0, 6, upper_line, ln=True)
                
                # Crtanje horizontalne razdelne linije
                current_y = pdf.get_y()
                pdf.set_draw_color(100, 100, 100) # Siva linija
                pdf.line(10, current_y, 200, current_y)
                pdf.ln(3)
                
            # 2. AKO JE PODNASLOV ZA POSAO (Pozicija | Firma | Datum)
            elif "|" in line and "‚Ä¢" not in line:
                pdf.set_font('ArialUni', size=10)
                pdf.set_text_color(0, 0, 0) # Crna, nagla≈°ena
                pdf.cell(0, 7, line, ln=True)
                
            # 3. AKO SU BULLET POENI (ili obrazovanje/sertifikati)
            elif line.startswith("‚Ä¢") or line.startswith("-"):
                pdf.set_font('ArialUni', size=9)
                pdf.set_text_color(50, 50, 50) # Tamno siva za lep≈°i kontrast
                pdf.set_x(14) # Uvlaƒçenje teksta udesno
                pdf.multi_cell(0, 5, line)
                pdf.set_x(10) # Vraƒáanje margine
                
            # 4. OBIƒåAN TEKST (Rezime, Ve≈°tine)
            else:
                pdf.set_font('ArialUni', size=9)
                pdf.set_text_color(50, 50, 50)
                pdf.multi_cell(0, 5, line)
        temp_dir = tempfile.gettempdir()
        unique_id = uuid.uuid4().hex
        safe_file_path = os.path.join(temp_dir, f"CVespresso_{unique_id}_{lang}.pdf")
        
        pdf.output(safe_file_path)
        
        # Zaka≈æi automatsko brisanje fajla u pozadini nakon slanja responsa
        background_tasks.add_task(remove_temp_file, safe_file_path)
        
        return FileResponse(
            path=safe_file_path, 
            filename=f"CVespresso_{lang}.pdf", 
            media_type='application/pdf'
        )
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"PDF Error: {str(e)}")


@app.post("/generate-cover-letter/")
@limiter.limit("5/minute")
async def generate_cover_letter(request: Request, dossier_req: FullDossierRequest, background_tasks: BackgroundTasks, lang: str = Query("sr", enum=["sr", "en"])):
    """Generi≈°e propratno pismo prilagoƒëeno poziciji"""
    
    clean_job_desc = sanitize_input(dossier_req.job_description)
    profile_data = sanitize_dossier(dossier_req.user_dossier) if dossier_req.user_dossier else DEFAULT_MASTER_DOSSIER
    
    json_dossier = json.dumps(profile_data, ensure_ascii=False)
    
    if lang == "sr":
        sys_msg = """Ti si vrhunski HR struƒçnjak za pisanje propratnih pisama (Cover Letters).
        TVOJ JEDINI ZADATAK JE DA NAPI≈†E≈† ƒåIST TEKST PISMA. BEZ IKAKVOG UVODA ILI OBJA≈†NJENJA PRE PISMA.
        STROGA PRAVILA:
        1. BEZ KONTAKT PODATAKA I DATUMA na vrhu (sistem to sam dodaje).
        2. ISKLJUƒåIVO EKAVICA. Nema ijekavice.
        3. Pismo mora biti koncizno, profesionalno i uverljivo."""
        
        user_prompt = f"""
        Dosije: {json_dossier}
        Oglas: {clean_job_desc}
        
        ZADATAK:
        Napi≈°i propratno pismo prateƒái ISKLJUƒåIVO ovu formu:

        Po≈°tovani/a [Ime iz oglasa ili 'Timu za zapo≈°ljavanje' ako nema imena],

        [Uvod: Jasno navedi za koju poziciju aplicira≈° i za≈°to si idealan kandidat za kompaniju.]

        [Razrada: U 1-2 kratka pasusa pove≈æi 2-3 kljuƒçna dostignuƒáa ili ve≈°tine iz dosijea sa najva≈ænijim zahtevima iz oglasa. Poka≈æi konkretnu vrednost koju donosi≈°.]

        [Zakljuƒçak: Kratak poziv na akciju/intervju i zahvalnost na izdvojenom vremenu.]

        Srdaƒçan pozdrav,
        [Puno Ime kandidata iz dosijea]
        """
    else:
        sys_msg = """You are an elite Executive Career Coach specializing in Cover Letters.
        YOUR ONLY JOB IS TO WRITE THE CORE LETTER TEXT. NO INTRODUCTIONS, NO CHAT.
        STRICT RULES:
        1. TRANSLATE ALL RELEVANT CONTENT TO ENGLISH based on the dossier.
        2. NO CONTACT INFO OR DATES at the top (the system adds this automatically).
        3. The letter must be concise, confident, and highly tailored."""
        
        user_prompt = f"""
        Dossier: {json_dossier}
        Job: {clean_job_desc}
        
        TASK:
        Write a cover letter translating the candidate's background to English. STRICTLY use this format:

        Dear [Hiring Manager Name if in JD, otherwise 'Hiring Team'],

        [Opening: State the position you are applying for and a strong hook about why you are a great fit.]

        [Body: In 1-2 concise paragraphs, connect 2-3 key achievements or skills from the dossier to the most critical requirements in the job description. Show measurable impact.]

        [Conclusion: A brief call to action for an interview and gratitude for their time.]

        Sincerely,
        [Candidate's Full Name from dossier]
        """

    try:
        completion = client.chat.completions.create(
            model="llama-3.3-70b-versatile",
            messages=[
                {"role": "system", "content": sys_msg},
                {"role": "user", "content": user_prompt}
            ],
            temperature=0.5
        )
        cl_text = completion.choices[0].message.content
        
        pdf = FPDF()
        pdf.add_page()
        pdf.add_font('ArialUni', '', FONT_PATH, uni=True)
        
        # Generi≈°i ISTE kontakt podatke u zaglavlju i za Cover Letter
        create_pdf_header(pdf, profile_data)
        
        pdf.multi_cell(0, 7, cl_text.replace('**', ''))
        
        temp_dir = tempfile.gettempdir()
        unique_id = uuid.uuid4().hex
        safe_file_path = os.path.join(temp_dir, f"CoverLetter_{unique_id}_{lang}.pdf")
        
        pdf.output(safe_file_path)
        
        # Zaka≈æi automatsko brisanje
        background_tasks.add_task(remove_temp_file, safe_file_path)
        
        return FileResponse(
            path=safe_file_path, 
            filename=f"Cover_Letter_{lang}.pdf", 
            media_type='application/pdf'
        )
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
--------------------
END OF FILE: api\main.py

START OF FILE: api\templates\cv_template.html
--------------------
<!DOCTYPE html>
<html>
<head>
    <style>
        @page { margin: 2cm; }
        body { font-family: 'Helvetica', 'Arial', sans-serif; line-height: 1.5; color: #1a1c1e; margin: 0; }
        .header { text-align: left; margin-bottom: 30px; }
        .full-name { font-size: 24pt; font-weight: bold; color: #000; text-transform: uppercase; letter-spacing: -1px; }
        .contact-info { font-size: 9pt; color: #555; margin-top: 5px; }
        
        .section { margin-top: 25px; }
        .section-title { 
            font-size: 12pt; 
            font-weight: bold; 
            color: #004d99; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .content { margin-top: 10px; font-size: 10.5pt; text-align: justify; }
        
        /* Stil za tvoje projekte poput lumaerp.app ili Tron */
        .project-item { margin-bottom: 10px; }
        .project-name { font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <div class="full-name">{{ full_name }}</div>
        <div class="contact-info">
            {{ location }} | {{ email }} | {{ portfolio_url }}
        </div>
    </div>

    <div class="section">
        <div class="section-title">Professional Summary</div>
        <div class="content">{{ tailored_summary }}</div>
    </div>

    <div class="section">
        <div class="section-title">Key Projects & Automation</div>
        <div class="content">
            {{ tailored_projects }}
        </div>
    </div>
</body>
</html>
--------------------
END OF FILE: api\templates\cv_template.html

START OF FILE: static\manifest.json
--------------------
{
  "name": "CVespresso",
  "short_name": "CVespresso",
  "description": "AI alat za generisanje ATS-optimizovanih CV-jeva i propratnih pisama.",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#111827",
  "theme_color": "#111827",
  "icons": [
    {
      "src": "/static/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/static/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
--------------------
END OF FILE: static\manifest.json

START OF FILE: static\sw.js
--------------------
const CACHE_NAME = 'cvespresso-cache-v1';
const urlsToCache = [
  '/',
  '/static/css/tailwind-output.css',
  '/static/js/main.js',
  '/static/js/api.js',
  '/static/js/auth.js',
  '/static/js/dossier.js'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(cache => cache.addAll(urlsToCache))
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request)
      .then(response => response || fetch(event.request))
  );
});
--------------------
END OF FILE: static\sw.js

START OF FILE: static\css\style.css
--------------------
@import "tailwindcss";
@source "../../index.html";
@source "../js/**/*.js";
@source "../../api/templates/**/*.html";

/* OKLCH paleta */
:root {
    --bg: oklch(0.97 0.01 75); /* Topla, prigu≈°ena bela - ne zamara oƒçi */
    --border: oklch(0.88 0.01 75); /* Prilagoƒëena ivica uz novu pozadinu */
    --border-hover: oklch(0.20 0.02 75); /* Mek≈°a crna za tekst i hover */
    --footer: oklch(0.80 0.01 75);
}

.dark {
    --bg: oklch(0.25 0.02 240);
    --border: oklch(0.35 0.02 240);
    --border-hover: oklch(0.99 0 0);
    --footer: oklch(0.30 0.02 240);
}

body { 
    background-color: var(--bg); 
    color: var(--border-hover); 
}

.btn-espresso {
    background-color: transparent;
    border: 2px solid var(--border); /* Podebljano sa 1px na 2px */
    color: var(--border-hover);
    transition: all 0.4s ease; /* Usporeno za glatkiji, zen prelaz */
}

.btn-espresso:hover {
    border-color: var(--border-hover);
    /* Suptilni glow efekat pri prelasku mi≈°a (20% vidljivosti boje teksta) */
    box-shadow: 0 0 20px color-mix(in oklch, var(--border-hover) 20%, transparent);
}

.icon-toggle { 
    width: 20px; 
    height: 20px; 
    stroke: currentColor; 
    fill: none; 
    opacity: 0.4; 
    transition: opacity 0.3s; 
}

.icon-toggle:hover { opacity: 1; }

textarea { 
    background-color: transparent; 
    border: 1px solid var(--border); 
    color: inherit; 
}

/* --- GLAVNI UNOS (JOB SPECS) --- */
textarea { 
    background-color: transparent; 
    border: 2px solid var(--border); /* Podebljano na 2px */
    color: inherit; 
    transition: all 0.4s ease; /* Dodata glatka tranzicija */
}

textarea:focus { 
    border-color: var(--border-hover); 
    outline: none; 
    /* Razliveni, duboki glow kada se klikne na polje (15% vidljivosti) */
    box-shadow: 0 0 25px color-mix(in oklch, var(--border-hover) 15%, transparent);
}

footer { color: var(--footer); }

/* Font Setup za Tailwind */
.font-cursive { font-family: 'Satisfy', cursive; }

/* Editor overlay */
#dossierEditor {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bg);
    z-index: 100;
    overflow-y: auto;
}

/* --- MASTER DOSIJE FORMA --- */
.dossier-input {
    width: 100%;
    padding: 1rem;
    background-color: transparent;
    border: 2px solid var(--border); /* Podebljano na 2px */
    border-radius: 0.5rem;
    font-size: 0.875rem;
    outline: none;
    transition: all 0.4s ease;
}

.dossier-input:focus {
    border-color: var(--border-hover);
    /* Malo manji glow za manja polja u dosijeu */
    box-shadow: 0 0 15px color-mix(in oklch, var(--border-hover) 15%, transparent);
}

.hidden { 
    display: none !important; 
}
--------------------
END OF FILE: static\css\style.css

START OF FILE: static\css\tailwind-output.css
--------------------
/*! tailwindcss v4.2.1 | MIT License | https://tailwindcss.com */
@layer properties;
@layer theme, base, components, utilities;
@layer theme {
  :root, :host {
    --font-sans: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
    'Noto Color Emoji';
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New',
    monospace;
    --color-red-500: oklch(63.7% 0.237 25.331);
    --color-red-900: oklch(39.6% 0.141 25.723);
    --color-green-500: oklch(72.3% 0.219 149.579);
    --color-blue-500: oklch(62.3% 0.214 259.815);
    --color-gray-400: oklch(70.7% 0.022 261.325);
    --color-black: #000;
    --color-white: #fff;
    --spacing: 0.25rem;
    --container-lg: 32rem;
    --container-2xl: 42rem;
    --container-4xl: 56rem;
    --text-xs: 0.75rem;
    --text-xs--line-height: calc(1 / 0.75);
    --text-sm: 0.875rem;
    --text-sm--line-height: calc(1.25 / 0.875);
    --text-xl: 1.25rem;
    --text-xl--line-height: calc(1.75 / 1.25);
    --text-2xl: 1.5rem;
    --text-2xl--line-height: calc(2 / 1.5);
    --text-3xl: 1.875rem;
    --text-3xl--line-height: calc(2.25 / 1.875);
    --font-weight-bold: 700;
    --font-weight-black: 900;
    --tracking-tighter: -0.05em;
    --tracking-wider: 0.05em;
    --tracking-widest: 0.1em;
    --radius-lg: 0.5rem;
    --radius-xl: 0.75rem;
    --radius-2xl: 1rem;
    --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
    --default-transition-duration: 150ms;
    --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    --default-font-family: var(--font-sans);
    --default-mono-font-family: var(--font-mono);
  }
}
@layer base {
  *, ::after, ::before, ::backdrop, ::file-selector-button {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0 solid;
  }
  html, :host {
    line-height: 1.5;
    -webkit-text-size-adjust: 100%;
    tab-size: 4;
    font-family: var(--default-font-family, ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji');
    font-feature-settings: var(--default-font-feature-settings, normal);
    font-variation-settings: var(--default-font-variation-settings, normal);
    -webkit-tap-highlight-color: transparent;
  }
  hr {
    height: 0;
    color: inherit;
    border-top-width: 1px;
  }
  abbr:where([title]) {
    -webkit-text-decoration: underline dotted;
    text-decoration: underline dotted;
  }
  h1, h2, h3, h4, h5, h6 {
    font-size: inherit;
    font-weight: inherit;
  }
  a {
    color: inherit;
    -webkit-text-decoration: inherit;
    text-decoration: inherit;
  }
  b, strong {
    font-weight: bolder;
  }
  code, kbd, samp, pre {
    font-family: var(--default-mono-font-family, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace);
    font-feature-settings: var(--default-mono-font-feature-settings, normal);
    font-variation-settings: var(--default-mono-font-variation-settings, normal);
    font-size: 1em;
  }
  small {
    font-size: 80%;
  }
  sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
  }
  sub {
    bottom: -0.25em;
  }
  sup {
    top: -0.5em;
  }
  table {
    text-indent: 0;
    border-color: inherit;
    border-collapse: collapse;
  }
  :-moz-focusring {
    outline: auto;
  }
  progress {
    vertical-align: baseline;
  }
  summary {
    display: list-item;
  }
  ol, ul, menu {
    list-style: none;
  }
  img, svg, video, canvas, audio, iframe, embed, object {
    display: block;
    vertical-align: middle;
  }
  img, video {
    max-width: 100%;
    height: auto;
  }
  button, input, select, optgroup, textarea, ::file-selector-button {
    font: inherit;
    font-feature-settings: inherit;
    font-variation-settings: inherit;
    letter-spacing: inherit;
    color: inherit;
    border-radius: 0;
    background-color: transparent;
    opacity: 1;
  }
  :where(select:is([multiple], [size])) optgroup {
    font-weight: bolder;
  }
  :where(select:is([multiple], [size])) optgroup option {
    padding-inline-start: 20px;
  }
  ::file-selector-button {
    margin-inline-end: 4px;
  }
  ::placeholder {
    opacity: 1;
  }
  @supports (not (-webkit-appearance: -apple-pay-button))  or (contain-intrinsic-size: 1px) {
    ::placeholder {
      color: currentcolor;
      @supports (color: color-mix(in lab, red, red)) {
        color: color-mix(in oklab, currentcolor 50%, transparent);
      }
    }
  }
  textarea {
    resize: vertical;
  }
  ::-webkit-search-decoration {
    -webkit-appearance: none;
  }
  ::-webkit-date-and-time-value {
    min-height: 1lh;
    text-align: inherit;
  }
  ::-webkit-datetime-edit {
    display: inline-flex;
  }
  ::-webkit-datetime-edit-fields-wrapper {
    padding: 0;
  }
  ::-webkit-datetime-edit, ::-webkit-datetime-edit-year-field, ::-webkit-datetime-edit-month-field, ::-webkit-datetime-edit-day-field, ::-webkit-datetime-edit-hour-field, ::-webkit-datetime-edit-minute-field, ::-webkit-datetime-edit-second-field, ::-webkit-datetime-edit-millisecond-field, ::-webkit-datetime-edit-meridiem-field {
    padding-block: 0;
  }
  ::-webkit-calendar-picker-indicator {
    line-height: 1;
  }
  :-moz-ui-invalid {
    box-shadow: none;
  }
  button, input:where([type='button'], [type='reset'], [type='submit']), ::file-selector-button {
    appearance: button;
  }
  ::-webkit-inner-spin-button, ::-webkit-outer-spin-button {
    height: auto;
  }
  [hidden]:where(:not([hidden='until-found'])) {
    display: none !important;
  }
}
@layer utilities {
  .absolute {
    position: absolute;
  }
  .fixed {
    position: fixed;
  }
  .relative {
    position: relative;
  }
  .static {
    position: static;
  }
  .inset-0 {
    inset: calc(var(--spacing) * 0);
  }
  .-top-2 {
    top: calc(var(--spacing) * -2);
  }
  .top-0 {
    top: calc(var(--spacing) * 0);
  }
  .top-2 {
    top: calc(var(--spacing) * 2);
  }
  .top-4 {
    top: calc(var(--spacing) * 4);
  }
  .-right-2 {
    right: calc(var(--spacing) * -2);
  }
  .right-2 {
    right: calc(var(--spacing) * 2);
  }
  .right-6 {
    right: calc(var(--spacing) * 6);
  }
  .left-0 {
    left: calc(var(--spacing) * 0);
  }
  .z-10 {
    z-index: 10;
  }
  .z-50 {
    z-index: 50;
  }
  .z-\[100\] {
    z-index: 100;
  }
  .z-\[105\] {
    z-index: 105;
  }
  .z-\[110\] {
    z-index: 110;
  }
  .z-\[120\] {
    z-index: 120;
  }
  .z-\[150\] {
    z-index: 150;
  }
  .container {
    width: 100%;
    @media (width >= 40rem) {
      max-width: 40rem;
    }
    @media (width >= 48rem) {
      max-width: 48rem;
    }
    @media (width >= 64rem) {
      max-width: 64rem;
    }
    @media (width >= 80rem) {
      max-width: 80rem;
    }
    @media (width >= 96rem) {
      max-width: 96rem;
    }
  }
  .m-4 {
    margin: calc(var(--spacing) * 4);
  }
  .mx-4 {
    margin-inline: calc(var(--spacing) * 4);
  }
  .mx-auto {
    margin-inline: auto;
  }
  .mt-3 {
    margin-top: calc(var(--spacing) * 3);
  }
  .mt-10 {
    margin-top: calc(var(--spacing) * 10);
  }
  .mt-12 {
    margin-top: calc(var(--spacing) * 12);
  }
  .mt-auto {
    margin-top: auto;
  }
  .mb-1 {
    margin-bottom: calc(var(--spacing) * 1);
  }
  .mb-2 {
    margin-bottom: calc(var(--spacing) * 2);
  }
  .mb-3 {
    margin-bottom: calc(var(--spacing) * 3);
  }
  .mb-6 {
    margin-bottom: calc(var(--spacing) * 6);
  }
  .mb-12 {
    margin-bottom: calc(var(--spacing) * 12);
  }
  .mb-16 {
    margin-bottom: calc(var(--spacing) * 16);
  }
  .block {
    display: block;
  }
  .flex {
    display: flex;
  }
  .grid {
    display: grid;
  }
  .hidden {
    display: none;
  }
  .h-4 {
    height: calc(var(--spacing) * 4);
  }
  .h-5 {
    height: calc(var(--spacing) * 5);
  }
  .h-6 {
    height: calc(var(--spacing) * 6);
  }
  .h-20 {
    height: calc(var(--spacing) * 20);
  }
  .h-24 {
    height: calc(var(--spacing) * 24);
  }
  .h-\[90vh\] {
    height: 90vh;
  }
  .h-full {
    height: 100%;
  }
  .min-h-screen {
    min-height: 100vh;
  }
  .w-4 {
    width: calc(var(--spacing) * 4);
  }
  .w-5 {
    width: calc(var(--spacing) * 5);
  }
  .w-6 {
    width: calc(var(--spacing) * 6);
  }
  .w-20 {
    width: calc(var(--spacing) * 20);
  }
  .w-24 {
    width: calc(var(--spacing) * 24);
  }
  .w-80 {
    width: calc(var(--spacing) * 80);
  }
  .w-full {
    width: 100%;
  }
  .max-w-2xl {
    max-width: var(--container-2xl);
  }
  .max-w-4xl {
    max-width: var(--container-4xl);
  }
  .max-w-lg {
    max-width: var(--container-lg);
  }
  .flex-1 {
    flex: 1;
  }
  .flex-grow {
    flex-grow: 1;
  }
  .-translate-x-full {
    --tw-translate-x: -100%;
    translate: var(--tw-translate-x) var(--tw-translate-y);
  }
  .scale-95 {
    --tw-scale-x: 95%;
    --tw-scale-y: 95%;
    --tw-scale-z: 95%;
    scale: var(--tw-scale-x) var(--tw-scale-y);
  }
  .transform {
    transform: var(--tw-rotate-x,) var(--tw-rotate-y,) var(--tw-rotate-z,) var(--tw-skew-x,) var(--tw-skew-y,);
  }
  .resize-none {
    resize: none;
  }
  .grid-cols-1 {
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }
  .grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  .flex-col {
    flex-direction: column;
  }
  .items-baseline {
    align-items: baseline;
  }
  .items-center {
    align-items: center;
  }
  .justify-between {
    justify-content: space-between;
  }
  .justify-center {
    justify-content: center;
  }
  .gap-1 {
    gap: calc(var(--spacing) * 1);
  }
  .gap-2 {
    gap: calc(var(--spacing) * 2);
  }
  .gap-3 {
    gap: calc(var(--spacing) * 3);
  }
  .gap-4 {
    gap: calc(var(--spacing) * 4);
  }
  .gap-6 {
    gap: calc(var(--spacing) * 6);
  }
  .gap-8 {
    gap: calc(var(--spacing) * 8);
  }
  .space-y-3 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .space-y-4 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 4) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 4) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .space-y-6 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 6) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 6) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .space-y-8 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 8) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 8) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .space-y-10 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 10) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 10) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .space-y-12 {
    :where(& > :not(:last-child)) {
      --tw-space-y-reverse: 0;
      margin-block-start: calc(calc(var(--spacing) * 12) * var(--tw-space-y-reverse));
      margin-block-end: calc(calc(var(--spacing) * 12) * calc(1 - var(--tw-space-y-reverse)));
    }
  }
  .truncate {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .overflow-hidden {
    overflow: hidden;
  }
  .overflow-y-auto {
    overflow-y: auto;
  }
  .rounded {
    border-radius: 0.25rem;
  }
  .rounded-2xl {
    border-radius: var(--radius-2xl);
  }
  .rounded-full {
    border-radius: calc(infinity * 1px);
  }
  .rounded-lg {
    border-radius: var(--radius-lg);
  }
  .rounded-xl {
    border-radius: var(--radius-xl);
  }
  .border {
    border-style: var(--tw-border-style);
    border-width: 1px;
  }
  .border-t {
    border-top-style: var(--tw-border-style);
    border-top-width: 1px;
  }
  .border-r {
    border-right-style: var(--tw-border-style);
    border-right-width: 1px;
  }
  .border-b {
    border-bottom-style: var(--tw-border-style);
    border-bottom-width: 1px;
  }
  .border-\[var\(--border\)\] {
    border-color: var(--border);
  }
  .border-green-500\/50 {
    border-color: color-mix(in srgb, oklch(72.3% 0.219 149.579) 50%, transparent);
    @supports (color: color-mix(in lab, red, red)) {
      border-color: color-mix(in oklab, var(--color-green-500) 50%, transparent);
    }
  }
  .border-red-900\/20 {
    border-color: color-mix(in srgb, oklch(39.6% 0.141 25.723) 20%, transparent);
    @supports (color: color-mix(in lab, red, red)) {
      border-color: color-mix(in oklab, var(--color-red-900) 20%, transparent);
    }
  }
  .bg-\[var\(--bg\)\] {
    background-color: var(--bg);
  }
  .bg-black\/50 {
    background-color: color-mix(in srgb, #000 50%, transparent);
    @supports (color: color-mix(in lab, red, red)) {
      background-color: color-mix(in oklab, var(--color-black) 50%, transparent);
    }
  }
  .bg-black\/80 {
    background-color: color-mix(in srgb, #000 80%, transparent);
    @supports (color: color-mix(in lab, red, red)) {
      background-color: color-mix(in oklab, var(--color-black) 80%, transparent);
    }
  }
  .bg-red-500 {
    background-color: var(--color-red-500);
  }
  .bg-transparent {
    background-color: transparent;
  }
  .bg-white {
    background-color: var(--color-white);
  }
  .stroke-\[var\(--border-hover\)\] {
    stroke: var(--border-hover);
  }
  .p-1\.5 {
    padding: calc(var(--spacing) * 1.5);
  }
  .p-2 {
    padding: calc(var(--spacing) * 2);
  }
  .p-4 {
    padding: calc(var(--spacing) * 4);
  }
  .p-6 {
    padding: calc(var(--spacing) * 6);
  }
  .p-8 {
    padding: calc(var(--spacing) * 8);
  }
  .px-2 {
    padding-inline: calc(var(--spacing) * 2);
  }
  .px-4 {
    padding-inline: calc(var(--spacing) * 4);
  }
  .py-2 {
    padding-block: calc(var(--spacing) * 2);
  }
  .py-3 {
    padding-block: calc(var(--spacing) * 3);
  }
  .py-4 {
    padding-block: calc(var(--spacing) * 4);
  }
  .py-6 {
    padding-block: calc(var(--spacing) * 6);
  }
  .py-12 {
    padding-block: calc(var(--spacing) * 12);
  }
  .pr-6 {
    padding-right: calc(var(--spacing) * 6);
  }
  .pr-8 {
    padding-right: calc(var(--spacing) * 8);
  }
  .pb-2 {
    padding-bottom: calc(var(--spacing) * 2);
  }
  .pb-4 {
    padding-bottom: calc(var(--spacing) * 4);
  }
  .pb-6 {
    padding-bottom: calc(var(--spacing) * 6);
  }
  .pb-20 {
    padding-bottom: calc(var(--spacing) * 20);
  }
  .text-center {
    text-align: center;
  }
  .font-sans {
    font-family: var(--font-sans);
  }
  .text-2xl {
    font-size: var(--text-2xl);
    line-height: var(--tw-leading, var(--text-2xl--line-height));
  }
  .text-3xl {
    font-size: var(--text-3xl);
    line-height: var(--tw-leading, var(--text-3xl--line-height));
  }
  .text-sm {
    font-size: var(--text-sm);
    line-height: var(--tw-leading, var(--text-sm--line-height));
  }
  .text-xl {
    font-size: var(--text-xl);
    line-height: var(--tw-leading, var(--text-xl--line-height));
  }
  .text-xs {
    font-size: var(--text-xs);
    line-height: var(--tw-leading, var(--text-xs--line-height));
  }
  .text-\[8px\] {
    font-size: 8px;
  }
  .text-\[9px\] {
    font-size: 9px;
  }
  .text-\[10px\] {
    font-size: 10px;
  }
  .font-black {
    --tw-font-weight: var(--font-weight-black);
    font-weight: var(--font-weight-black);
  }
  .font-bold {
    --tw-font-weight: var(--font-weight-bold);
    font-weight: var(--font-weight-bold);
  }
  .tracking-\[0\.2em\] {
    --tw-tracking: 0.2em;
    letter-spacing: 0.2em;
  }
  .tracking-\[0\.3em\] {
    --tw-tracking: 0.3em;
    letter-spacing: 0.3em;
  }
  .tracking-\[0\.4em\] {
    --tw-tracking: 0.4em;
    letter-spacing: 0.4em;
  }
  .tracking-\[0\.5em\] {
    --tw-tracking: 0.5em;
    letter-spacing: 0.5em;
  }
  .tracking-\[0\.6em\] {
    --tw-tracking: 0.6em;
    letter-spacing: 0.6em;
  }
  .tracking-tighter {
    --tw-tracking: var(--tracking-tighter);
    letter-spacing: var(--tracking-tighter);
  }
  .tracking-wider {
    --tw-tracking: var(--tracking-wider);
    letter-spacing: var(--tracking-wider);
  }
  .tracking-widest {
    --tw-tracking: var(--tracking-widest);
    letter-spacing: var(--tracking-widest);
  }
  .text-\[var\(--border-hover\)\] {
    color: var(--border-hover);
  }
  .text-\[var\(--text\)\] {
    color: var(--text);
  }
  .text-blue-500 {
    color: var(--color-blue-500);
  }
  .text-green-500 {
    color: var(--color-green-500);
  }
  .text-red-500 {
    color: var(--color-red-500);
  }
  .text-red-500\/50 {
    color: color-mix(in srgb, oklch(63.7% 0.237 25.331) 50%, transparent);
    @supports (color: color-mix(in lab, red, red)) {
      color: color-mix(in oklab, var(--color-red-500) 50%, transparent);
    }
  }
  .text-white {
    color: var(--color-white);
  }
  .lowercase {
    text-transform: lowercase;
  }
  .uppercase {
    text-transform: uppercase;
  }
  .opacity-0 {
    opacity: 0%;
  }
  .opacity-20 {
    opacity: 20%;
  }
  .opacity-30 {
    opacity: 30%;
  }
  .opacity-40 {
    opacity: 40%;
  }
  .opacity-50 {
    opacity: 50%;
  }
  .opacity-80 {
    opacity: 80%;
  }
  .shadow-2xl {
    --tw-shadow: 0 25px 50px -12px var(--tw-shadow-color, rgb(0 0 0 / 0.25));
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }
  .shadow-inner {
    --tw-shadow: inset 0 2px 4px 0 var(--tw-shadow-color, rgb(0 0 0 / 0.05));
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }
  .shadow-md {
    --tw-shadow: 0 4px 6px -1px var(--tw-shadow-color, rgb(0 0 0 / 0.1)), 0 2px 4px -2px var(--tw-shadow-color, rgb(0 0 0 / 0.1));
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }
  .shadow-sm {
    --tw-shadow: 0 1px 3px 0 var(--tw-shadow-color, rgb(0 0 0 / 0.1)), 0 1px 2px -1px var(--tw-shadow-color, rgb(0 0 0 / 0.1));
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }
  .outline {
    outline-style: var(--tw-outline-style);
    outline-width: 1px;
  }
  .transition {
    transition-property: color, background-color, border-color, outline-color, text-decoration-color, fill, stroke, --tw-gradient-from, --tw-gradient-via, --tw-gradient-to, opacity, box-shadow, transform, translate, scale, rotate, filter, -webkit-backdrop-filter, backdrop-filter, display, content-visibility, overlay, pointer-events;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }
  .transition-all {
    transition-property: all;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }
  .transition-colors {
    transition-property: color, background-color, border-color, outline-color, text-decoration-color, fill, stroke, --tw-gradient-from, --tw-gradient-via, --tw-gradient-to;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }
  .transition-opacity {
    transition-property: opacity;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }
  .transition-transform {
    transition-property: transform, translate, scale, rotate;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }
  .duration-300 {
    --tw-duration: 300ms;
    transition-duration: 300ms;
  }
  .duration-500 {
    --tw-duration: 500ms;
    transition-duration: 500ms;
  }
  .ease-in-out {
    --tw-ease: var(--ease-in-out);
    transition-timing-function: var(--ease-in-out);
  }
  .select-none {
    -webkit-user-select: none;
    user-select: none;
  }
  .group-hover\:opacity-100 {
    &:is(:where(.group):hover *) {
      @media (hover: hover) {
        opacity: 100%;
      }
    }
  }
  .placeholder\:opacity-20 {
    &::placeholder {
      opacity: 20%;
    }
  }
  .hover\:border-\[var\(--border-hover\)\] {
    &:hover {
      @media (hover: hover) {
        border-color: var(--border-hover);
      }
    }
  }
  .hover\:border-gray-400 {
    &:hover {
      @media (hover: hover) {
        border-color: var(--color-gray-400);
      }
    }
  }
  .hover\:bg-green-500\/10 {
    &:hover {
      @media (hover: hover) {
        background-color: color-mix(in srgb, oklch(72.3% 0.219 149.579) 10%, transparent);
        @supports (color: color-mix(in lab, red, red)) {
          background-color: color-mix(in oklab, var(--color-green-500) 10%, transparent);
        }
      }
    }
  }
  .hover\:bg-red-500\/10 {
    &:hover {
      @media (hover: hover) {
        background-color: color-mix(in srgb, oklch(63.7% 0.237 25.331) 10%, transparent);
        @supports (color: color-mix(in lab, red, red)) {
          background-color: color-mix(in oklab, var(--color-red-500) 10%, transparent);
        }
      }
    }
  }
  .hover\:text-red-500 {
    &:hover {
      @media (hover: hover) {
        color: var(--color-red-500);
      }
    }
  }
  .hover\:text-white {
    &:hover {
      @media (hover: hover) {
        color: var(--color-white);
      }
    }
  }
  .hover\:opacity-100 {
    &:hover {
      @media (hover: hover) {
        opacity: 100%;
      }
    }
  }
  .focus\:outline-none {
    &:focus {
      --tw-outline-style: none;
      outline-style: none;
    }
  }
  .md\:w-1\/5 {
    @media (width >= 48rem) {
      width: calc(1 / 5 * 100%);
    }
  }
  .md\:w-2\/5 {
    @media (width >= 48rem) {
      width: calc(2 / 5 * 100%);
    }
  }
  .md\:grid-cols-2 {
    @media (width >= 48rem) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
  .md\:grid-cols-3 {
    @media (width >= 48rem) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
  }
  .md\:flex-row {
    @media (width >= 48rem) {
      flex-direction: row;
    }
  }
  .md\:p-20 {
    @media (width >= 48rem) {
      padding: calc(var(--spacing) * 20);
    }
  }
}
:root {
  --bg: oklch(0.97 0.01 75);
  --border: oklch(0.88 0.01 75);
  --border-hover: oklch(0.20 0.02 75);
  --footer: oklch(0.80 0.01 75);
}
.dark {
  --bg: oklch(0.25 0.02 240);
  --border: oklch(0.35 0.02 240);
  --border-hover: oklch(0.99 0 0);
  --footer: oklch(0.30 0.02 240);
}
body {
  background-color: var(--bg);
  color: var(--border-hover);
}
.btn-espresso {
  background-color: transparent;
  border: 2px solid var(--border);
  color: var(--border-hover);
  transition: all 0.4s ease;
}
.btn-espresso:hover {
  border-color: var(--border-hover);
  box-shadow: 0 0 20px var(--border-hover);
  @supports (color: color-mix(in lab, red, red)) {
    box-shadow: 0 0 20px color-mix(in oklch, var(--border-hover) 20%, transparent);
  }
}
.icon-toggle {
  width: 20px;
  height: 20px;
  stroke: currentColor;
  fill: none;
  opacity: 0.4;
  transition: opacity 0.3s;
}
.icon-toggle:hover {
  opacity: 1;
}
textarea {
  background-color: transparent;
  border: 1px solid var(--border);
  color: inherit;
}
textarea {
  background-color: transparent;
  border: 2px solid var(--border);
  color: inherit;
  transition: all 0.4s ease;
}
textarea:focus {
  border-color: var(--border-hover);
  outline: none;
  box-shadow: 0 0 25px var(--border-hover);
  @supports (color: color-mix(in lab, red, red)) {
    box-shadow: 0 0 25px color-mix(in oklch, var(--border-hover) 15%, transparent);
  }
}
footer {
  color: var(--footer);
}
.font-cursive {
  font-family: 'Satisfy', cursive;
}
#dossierEditor {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: var(--bg);
  z-index: 100;
  overflow-y: auto;
}
.dossier-input {
  width: 100%;
  padding: 1rem;
  background-color: transparent;
  border: 2px solid var(--border);
  border-radius: 0.5rem;
  font-size: 0.875rem;
  outline: none;
  transition: all 0.4s ease;
}
.dossier-input:focus {
  border-color: var(--border-hover);
  box-shadow: 0 0 15px var(--border-hover);
  @supports (color: color-mix(in lab, red, red)) {
    box-shadow: 0 0 15px color-mix(in oklch, var(--border-hover) 15%, transparent);
  }
}
.hidden {
  display: none !important;
}
@property --tw-translate-x {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}
@property --tw-translate-y {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}
@property --tw-translate-z {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}
@property --tw-scale-x {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}
@property --tw-scale-y {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}
@property --tw-scale-z {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}
@property --tw-rotate-x {
  syntax: "*";
  inherits: false;
}
@property --tw-rotate-y {
  syntax: "*";
  inherits: false;
}
@property --tw-rotate-z {
  syntax: "*";
  inherits: false;
}
@property --tw-skew-x {
  syntax: "*";
  inherits: false;
}
@property --tw-skew-y {
  syntax: "*";
  inherits: false;
}
@property --tw-space-y-reverse {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}
@property --tw-border-style {
  syntax: "*";
  inherits: false;
  initial-value: solid;
}
@property --tw-font-weight {
  syntax: "*";
  inherits: false;
}
@property --tw-tracking {
  syntax: "*";
  inherits: false;
}
@property --tw-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}
@property --tw-shadow-color {
  syntax: "*";
  inherits: false;
}
@property --tw-shadow-alpha {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 100%;
}
@property --tw-inset-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}
@property --tw-inset-shadow-color {
  syntax: "*";
  inherits: false;
}
@property --tw-inset-shadow-alpha {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 100%;
}
@property --tw-ring-color {
  syntax: "*";
  inherits: false;
}
@property --tw-ring-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}
@property --tw-inset-ring-color {
  syntax: "*";
  inherits: false;
}
@property --tw-inset-ring-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}
@property --tw-ring-inset {
  syntax: "*";
  inherits: false;
}
@property --tw-ring-offset-width {
  syntax: "<length>";
  inherits: false;
  initial-value: 0px;
}
@property --tw-ring-offset-color {
  syntax: "*";
  inherits: false;
  initial-value: #fff;
}
@property --tw-ring-offset-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}
@property --tw-outline-style {
  syntax: "*";
  inherits: false;
  initial-value: solid;
}
@property --tw-duration {
  syntax: "*";
  inherits: false;
}
@property --tw-ease {
  syntax: "*";
  inherits: false;
}
@layer properties {
  @supports ((-webkit-hyphens: none) and (not (margin-trim: inline))) or ((-moz-orient: inline) and (not (color:rgb(from red r g b)))) {
    *, ::before, ::after, ::backdrop {
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-translate-z: 0;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-scale-z: 1;
      --tw-rotate-x: initial;
      --tw-rotate-y: initial;
      --tw-rotate-z: initial;
      --tw-skew-x: initial;
      --tw-skew-y: initial;
      --tw-space-y-reverse: 0;
      --tw-border-style: solid;
      --tw-font-weight: initial;
      --tw-tracking: initial;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-color: initial;
      --tw-shadow-alpha: 100%;
      --tw-inset-shadow: 0 0 #0000;
      --tw-inset-shadow-color: initial;
      --tw-inset-shadow-alpha: 100%;
      --tw-ring-color: initial;
      --tw-ring-shadow: 0 0 #0000;
      --tw-inset-ring-color: initial;
      --tw-inset-ring-shadow: 0 0 #0000;
      --tw-ring-inset: initial;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-outline-style: solid;
      --tw-duration: initial;
      --tw-ease: initial;
    }
  }
}

--------------------
END OF FILE: static\css\tailwind-output.css

START OF FILE: static\js\api.js
--------------------
/**
 * CVespresso - API Bridge & Archive Manager
 * Verzija: 8.1 (Zakljuƒçavanje dugmadi + Vidljivo Delete dugme)
 */

document.getElementById('btnCV').addEventListener('click', () => generate('cv'));
document.getElementById('btnCL').addEventListener('click', () => generate('cl'));

let currentSession = { jobDesc: "", appId: null };

function cleanText(text) {
    return text ? text.replace(/<[^>]*>?/gm, '').trim() : "";
}

// OTVARANJE PDF PREVIEW MODALA
function openPdfPreview(url, fileName) {
    const pdfModal = document.getElementById('pdfModal');
    const pdfFrame = document.getElementById('pdfFrame');
    const btnDownload = document.getElementById('btnDownloadPdf');
    const btnClose = document.getElementById('btnClosePdf');

    if (!pdfModal || !pdfFrame) {
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        a.remove();
        return;
    }
    pdfFrame.src = url;
    pdfModal.classList.remove('hidden');

    btnDownload.onclick = () => {
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        a.remove();
    };

    btnClose.onclick = () => {
        pdfModal.classList.add('hidden');
        setTimeout(() => { pdfFrame.src = ""; window.URL.revokeObjectURL(url); }, 300);
    };
}

// GLAVNA FUNKCIJA
async function generate(type) {
    const descField = document.getElementById('jobDesc');
    const desc = cleanText(descField.value);

    if (!desc) { alert("Zalepite oglas za posao."); return; }

    const db = window._supabase || window.supabase;
    let user = null;
    if (db) {
        const { data } = await db.auth.getUser();
        user = data?.user;
    }

    const isNewJob = (desc !== currentSession.jobDesc);
    let companyName = "Nova Aplikacija";

    if (isNewJob && user) {
        companyName = prompt("Unesite ime kompanije za koju aplicirate (za arhivu):", "Ime kompanije");
        if (!companyName) companyName = "Nepoznata Kompanija";
    }

    let currentDossier = JSON.parse(localStorage.getItem('cv_espresso_dossier')) || (typeof masterDossier !== 'undefined' ? masterDossier : {});
    currentDossier.full_name = cleanText(currentDossier.full_name || "User");

    // ZAKLJUƒåAVANJE OBA DUGMETA DA SPREƒåIMO DUPLE KARTICE
    descField.style.opacity = "0.5";
    descField.disabled = true;
    
    const btnCV = document.getElementById('btnCV');
    const btnCL = document.getElementById('btnCL');
    const originalTextCV = btnCV.innerText;
    const originalTextCL = btnCL.innerText;
    
    btnCV.disabled = true;
    btnCL.disabled = true;
    
    if (type === 'cv') btnCV.innerText = "Cooking...";
    else btnCL.innerText = "Cooking...";

    // Osiguraƒç za jezik
    const lang = (typeof currentLang !== 'undefined') ? currentLang : 'sr';

    try {
        const response = await fetch(`${type === 'cv' ? '/generate-pdf/' : '/generate-cover-letter/'}?lang=${lang}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ job_description: desc, user_dossier: currentDossier })
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const filePrefix = type === 'cv' ? 'CV' : 'CoverLetter';
            const fileName = `CVespresso_${filePrefix}_${currentDossier.full_name.replace(/\s+/g, '_')}_${lang}.pdf`;

            openPdfPreview(url, fileName);

            // UPIS U BAZU
            if (user && isNewJob) {
                const newApp = {
                    user_id: user.id,
                    company_name: companyName,
                    job_description: desc,
                    cv_data: currentDossier
                };

                const { data, error } = await db.from('applications').insert(newApp).select();
                if (!error && data) {
                    currentSession.jobDesc = desc;
                    currentSession.appId = data[0].id;
                    loadApplications();
                }
            }
        } else {
            alert("‚ùå Python server prijavio gre≈°ku.");
        }
    } catch (err) {
        console.error("üö® Mre≈æna gre≈°ka:", err);
    } finally {
        // OTKLJUƒåAVANJE
        descField.style.opacity = "1";
        descField.disabled = false;
        btnCV.innerText = originalTextCV;
        btnCL.innerText = originalTextCL;
        btnCV.disabled = false;
        btnCL.disabled = false;
    }
}

// REGENERACIJA IZ ARHIVE (Popravljen event bag)
window.rebuildFromArchive = async function(event, appId, type) {
    const btnId = event.currentTarget;
    const originalText = btnId.innerText;
    
    try {
        const db = window._supabase || window.supabase;
        const { data, error } = await db.from('applications').select('*').eq('id', appId).single();
        if (error || !data) throw error;

        btnId.innerText = "Wait...";
        btnId.disabled = true;

        const lang = (typeof currentLang !== 'undefined') ? currentLang : 'sr';

        const response = await fetch(`${type === 'cv' ? '/generate-pdf/' : '/generate-cover-letter/'}?lang=${lang}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ job_description: data.job_description, user_dossier: data.cv_data })
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            openPdfPreview(url, `CVespresso_Archive_${lang}.pdf`);
        } else {
            throw new Error("Server vratio gre≈°ku pri generisanju.");
        }
    } catch (err) { 
        console.error(err);
        alert("Gre≈°ka pri preuzimanju iz arhive."); 
    } finally {
        btnId.innerText = originalText;
        btnId.disabled = false;
    }
}

async function loadApplications() {
    const listContainer = document.getElementById('applicationsList');
    if (!listContainer) return;

    const db = window._supabase || window.supabase;
    if (!db) return;

    try {
        const { data: { user } } = await db.auth.getUser();
        if (!user) return;

        const { data, error } = await db.from('applications').select('*').eq('user_id', user.id).order('created_at', { ascending: false });
        if (error) throw error;

        if (data.length === 0) {
            listContainer.innerHTML = `<div class="text-center opacity-20 text-[10px] uppercase font-bold tracking-widest mt-10">Nema saƒçuvanih aplikacija</div>`;
            return;
        }

        let html = '';
        data.forEach(app => {
            const date = new Date(app.created_at).toLocaleDateString('sr-RS');
            const company = app.company_name || "Nepoznata Kompanija";
            
            // A≈æuriran HTML kartice sa vidljivim dugmetom za brisanje
            html += `
            <div class="p-4 border border-[var(--border)] rounded-xl relative group hover:border-[var(--border-hover)] bg-[var(--bg)] shadow-sm mt-3">
                
                <button onclick="deleteApplication('${app.id}')" class="absolute top-2 right-2 text-red-500/50 hover:text-red-500 hover:bg-red-500/10 p-1.5 rounded transition-all" title="Obri≈°i aplikaciju">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                    </svg>
                </button>

                <h4 class="font-bold text-xs uppercase tracking-wider mb-1 pr-8 truncate" title="${company}">${cleanText(company)}</h4>
                <p class="text-[9px] opacity-40 mb-3">${date}</p>
                <div class="flex gap-2 items-center">
                    <button onclick="rebuildFromArchive(event, '${app.id}', 'cv')" class="text-[8px] border border-[var(--border)] px-2 py-2 rounded uppercase font-bold tracking-widest flex-1 hover:border-gray-400 transition-colors">CV</button>
                    <button onclick="rebuildFromArchive(event, '${app.id}', 'cl')" class="text-[8px] border border-[var(--border)] px-2 py-2 rounded uppercase font-bold tracking-widest flex-1 hover:border-gray-400 transition-colors">Letter</button>
                </div>
            </div>`;
        });
        listContainer.innerHTML = html;
    } catch (err) { console.error("Gre≈°ka pri fioci:", err); }
}

window.deleteApplication = async function(id) {
    if (!confirm("Obrisati ovu aplikaciju iz arhive?")) return;
    try {
        const db = window._supabase || window.supabase;
        await db.from('applications').delete().eq('id', id);
        if (currentSession.appId === id) {
            currentSession.jobDesc = "";
            currentSession.appId = null;
        }
        loadApplications(); 
    } catch (err) { alert("Gre≈°ka pri brisanju."); }
}

document.addEventListener('DOMContentLoaded', () => {
    const interval = setInterval(() => {
        const db = window._supabase || window.supabase;
        if (db) {
            clearInterval(interval);
            db.auth.onAuthStateChange((event, session) => {
                if (session) loadApplications();
            });
            db.auth.getUser().then(({data}) => {
                if(data?.user) loadApplications();
            });
        }
    }, 500);
});
--------------------
END OF FILE: static\js\api.js

START OF FILE: static\js\auth.js
--------------------
/**
 * CVespresso - Supabase Auth (MINIMALNA RADNA VERZIJA)
 * Fokus: Login/Logout + background sync, bez auto-rendera
 */

// ============================================
// 1. KONFIGURACIJA
// ============================================
const SUPABASE_URL = 'https://vywoekaobnhbyoxuozbq.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5d29la2FvYm5oYnlveHVvemJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNzM2NjcsImV4cCI6MjA4NzY0OTY2N30.hph67oSWjYM414sOLXTz6tO75fiEWkzsvp3B-ViU1Vk';

// 1. KREIRANJE GLOBALNE KONEKCIJE (OVO RE≈†AVA SVE TVOJE BAGOVE!)
window._supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const _supabase = window._supabase; 

let syncLock = false;

// 2. LOGIN / LOGOUT
window.loginWithGoogle = async function() {
    try {
        await _supabase.auth.signInWithOAuth({
            provider: 'google',
            options: { redirectTo: window.location.origin }
        });
    } catch (e) {
        console.error("Login error:", e);
        alert("Gre≈°ka pri prijavi: " + e.message);
    }
};

window.logout = async function() {
    try {
        await _supabase.auth.signOut();
        localStorage.removeItem('cv_espresso_dossier');
        window.location.reload();
    } catch (e) {}
};

// 3. SYNC IZ CLOUD-A (Uƒçitavanje dosijea iz baze)
window.fetchProfileFromCloud = async function(userId) {
    if (syncLock) return;
    syncLock = true;
    try {
        const { data, error } = await _supabase.from('profiles').select('cv_data').eq('id', userId).single();
        if (data && data.cv_data) {
            if (typeof masterDossier !== 'undefined') Object.assign(masterDossier, data.cv_data);
            localStorage.setItem('cv_espresso_dossier', JSON.stringify(data.cv_data));
        }
    } catch (e) {} finally { syncLock = false; }
};

// 4. SYNC NA CLOUD (Snimanje dosijea u bazu)
window.syncDossierToCloud = async function(dossierData) {
    if (syncLock) return;
    syncLock = true;
    try {
        const { data: { user } } = await _supabase.auth.getUser();
        if (!user) return; 
        await _supabase.from('profiles').upsert({ id: user.id, cv_data: dossierData });
    } catch (e) {} finally { syncLock = false; }
};

// 5. AUTH STATE LISTENER (Pali/gasi dugmiƒáe)
_supabase.auth.onAuthStateChange((event, session) => {
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');
    if (session) {
        if (btnLogin) btnLogin.classList.add('hidden');
        if (btnLogout) btnLogout.classList.remove('hidden');
        window.fetchProfileFromCloud(session.user.id);
    } else {
        if (btnLogin) btnLogin.classList.remove('hidden');
        if (btnLogout) btnLogout.classList.add('hidden');
    }
});

// 6. INIT CHECK
(async () => {
    try {
        const { data: { session } } = await _supabase.auth.getSession();
        if (session) window.fetchProfileFromCloud(session.user.id);
    } catch (e) {}
})();

--------------------
END OF FILE: static\js\auth.js

START OF FILE: static\js\dossier.js
--------------------
/**
 * CVespresso - Master Dossier Logic
 * Dodate socijalne mre≈æe, portfolio linkovi i re≈°en bag sa brisanjem teksta pri dodavanju reda
 */

// 1. DUMMY PROFILE
const dummyProfile = {
    full_name: "Ime i Prezime",
    title: "Va≈°a Profesionalna Titula",
    motto: "Va≈° profesionalni moto",
    email: "vas.email@primer.com",
    phone: "+381 60 000 0000",
    location: "Grad, Dr≈æava",
    linkedin: "linkedin.com/in/korisnik",
    github: "github.com/korisnik",
    website: "www.mojsajt.com",
    experience: [
        { role: "Va≈°a Pozicija", company: "Naziv Firme", period: "2020 - 2024", desc: "Opis dostignuƒáa" }
    ],
    education: [
        { degree: "Stepen obrazovanja", school: "Naziv ≈°kole", year: "Godina" }
    ],
    skills: {
        technical: ["Python", "SQL"],
        industry: ["Offset ≈°tampa"],
        soft: ["Liderstvo"]
    },
    certifications: [
        { name: "Naziv Sertifikata", year: "2026" }
    ],
    projects: [
        { name: "Naziv Projekta", desc: "Opis projekta" }
    ]
};

// 2. GLOBALNI MASTER DOSSIER
let masterDossier = null;

// 3. INICIJALIZACIJA
function initializeDossier() {
    console.log("=== üì¶ DOSSIER INIT STARTED ===");
    
    let savedDossier = null;
    try {
        const stored = localStorage.getItem('cv_espresso_dossier');
        if (stored && stored.trim() !== "") {
            savedDossier = JSON.parse(stored);
            console.log("‚úÖ LocalStorage: FOUND");
        } else {
            console.log("üìÅ LocalStorage: EMPTY");
        }
    } catch (e) {
        console.error("‚ùå LocalStorage error:", e);
        localStorage.removeItem('cv_espresso_dossier');
    }
    
    const hasValidData = savedDossier && 
                         savedDossier.full_name && 
                         savedDossier.full_name.trim() !== "" &&
                         savedDossier.full_name !== "Ime i Prezime";
    
    masterDossier = {
        full_name: hasValidData ? savedDossier.full_name : dummyProfile.full_name,
        title: hasValidData ? savedDossier.title : dummyProfile.title,
        motto: hasValidData ? savedDossier.motto : dummyProfile.motto,
        email: hasValidData ? savedDossier.email : dummyProfile.email,
        phone: hasValidData ? savedDossier.phone : dummyProfile.phone,
        location: hasValidData ? savedDossier.location : dummyProfile.location,
        linkedin: hasValidData && savedDossier.linkedin ? savedDossier.linkedin : dummyProfile.linkedin,
        github: hasValidData && savedDossier.github ? savedDossier.github : dummyProfile.github,
        website: hasValidData && savedDossier.website ? savedDossier.website : dummyProfile.website,
        experience: (hasValidData && Array.isArray(savedDossier.experience)) 
                    ? savedDossier.experience 
                    : JSON.parse(JSON.stringify(dummyProfile.experience)),
        education: (hasValidData && Array.isArray(savedDossier.education)) 
                   ? savedDossier.education 
                   : JSON.parse(JSON.stringify(dummyProfile.education)),
        certifications: (hasValidData && Array.isArray(savedDossier.certifications)) 
                        ? savedDossier.certifications 
                        : JSON.parse(JSON.stringify(dummyProfile.certifications)),
        projects: (hasValidData && Array.isArray(savedDossier.projects)) 
                  ? savedDossier.projects 
                  : JSON.parse(JSON.stringify(dummyProfile.projects)),
        skills: hasValidData && savedDossier.skills 
                ? savedDossier.skills 
                : JSON.parse(JSON.stringify(dummyProfile.skills))
    };
    
    localStorage.setItem('cv_espresso_dossier', JSON.stringify(masterDossier));
    
    console.log("=== üì¶ DOSSIER INIT COMPLETE ===");
}

// 4. DOM READY
document.addEventListener('DOMContentLoaded', () => {
    console.log("=== üöÄ DOM CONTENT LOADED ===");
    initializeDossier();
    
    const openDossierBtn = document.getElementById('openDossier');
    const dossierEditor = document.getElementById('dossierEditor');
    
    if (openDossierBtn && dossierEditor) {
        openDossierBtn.addEventListener('click', () => {
            dossierEditor.classList.remove('hidden');
            renderProfessionalForm();
        });
    }
    
    window.renderProfessionalForm = renderProfessionalForm;
    window.saveProfessionalDossier = saveProfessionalDossier;
    window.addEntry = addEntry;
    window.removeEntry = removeEntry;
});

// 5. RENDER FORME
function renderProfessionalForm() {
    const container = document.getElementById('formContainer');
    if (!container) return;
    
    if (!masterDossier) initializeDossier();
    if (!masterDossier.skills) masterDossier.skills = { technical: [], industry: [], soft: [] };
    
    container.innerHTML = `
    <div class="space-y-12 pb-20">
        <section class="space-y-4">
            <h3 class="text-[10px] font-black uppercase tracking-[0.4em] opacity-30 border-b border-[var(--border)] pb-2">01. Liƒçni Podaci & Linkovi</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="fName" value="${escapeHtml(masterDossier.full_name)}" class="dossier-input" placeholder="Puno ime">
                <input type="text" id="fTitle" value="${escapeHtml(masterDossier.title)}" class="dossier-input" placeholder="Titula">
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="email" id="fEmail" value="${escapeHtml(masterDossier.email)}" class="dossier-input" placeholder="Email">
                <input type="text" id="fPhone" value="${escapeHtml(masterDossier.phone)}" class="dossier-input" placeholder="Telefon">
                <input type="text" id="fLoc" value="${escapeHtml(masterDossier.location)}" class="dossier-input" placeholder="Lokacija">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="fLinkedin" value="${escapeHtml(masterDossier.linkedin || '')}" class="dossier-input" placeholder="LinkedIn URL">
                <input type="text" id="fGithub" value="${escapeHtml(masterDossier.github || '')}" class="dossier-input" placeholder="GitHub URL">
                <input type="text" id="fWebsite" value="${escapeHtml(masterDossier.website || '')}" class="dossier-input" placeholder="Liƒçni vebsajt / Portfolio">
            </div>
            
            <textarea id="fMotto" class="dossier-input h-20" placeholder="Motto">${escapeHtml(masterDossier.motto)}</textarea>
        </section>

        <section class="space-y-4">
            <div class="flex justify-between items-center border-b border-[var(--border)] pb-2">
                <h3 class="text-[10px] font-black uppercase tracking-[0.4em] opacity-30">02. Obrazovanje</h3>
                <button onclick="addEntry('education')" class="text-[9px] font-bold text-blue-500 uppercase">+ Dodaj</button>
            </div>
            <div id="educationList" class="space-y-4">
                ${(masterDossier.education || []).map((edu, i) => renderEntry('education', edu, i)).join('')}
            </div>
        </section>

        <section class="space-y-4">
            <div class="flex justify-between items-center border-b border-[var(--border)] pb-2">
                <h3 class="text-[10px] font-black uppercase tracking-[0.4em] opacity-30">03. Iskustvo</h3>
                <button onclick="addEntry('experience')" class="text-[9px] font-bold text-blue-500 uppercase">+ Dodaj</button>
            </div>
            <div id="experienceList" class="space-y-6">
                ${(masterDossier.experience || []).map((exp, i) => renderEntry('experience', exp, i)).join('')}
            </div>
        </section>

        <section class="space-y-6">
            <h3 class="text-[10px] font-black uppercase tracking-[0.4em] opacity-30 border-b border-[var(--border)] pb-2">04. Ve≈°tine</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="text-[9px] font-bold uppercase opacity-50 block mb-2">Tehniƒçke</label>
                    <textarea id="skillTech" class="dossier-input text-xs h-24" placeholder="Python, JS...">${escapeHtml((masterDossier.skills?.technical || []).join(', '))}</textarea>
                </div>
                <div>
                    <label class="text-[9px] font-bold uppercase opacity-50 block mb-2">Industrijske</label>
                    <textarea id="skillInd" class="dossier-input text-xs h-24" placeholder="Offset...">${escapeHtml((masterDossier.skills?.industry || []).join(', '))}</textarea>
                </div>
                <div>
                    <label class="text-[9px] font-bold uppercase opacity-50 block mb-2">Meke ve≈°tine</label>
                    <textarea id="skillSoft" class="dossier-input text-xs h-24" placeholder="Leadership...">${escapeHtml((masterDossier.skills?.soft || []).join(', '))}</textarea>
                </div>
            </div>
        </section>

        <section class="space-y-4">
            <div class="flex justify-between items-center border-b border-[var(--border)] pb-2">
                <h3 class="text-[10px] font-black uppercase tracking-[0.4em] opacity-30">05. Sertifikati</h3>
                <button onclick="addEntry('certifications')" class="text-[9px] font-bold text-blue-500 uppercase">+ Dodaj</button>
            </div>
            <div id="certificationsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${(masterDossier.certifications || []).map((cert, i) => renderEntry('certifications', cert, i)).join('')}
            </div>
        </section>

        <button onclick="saveProfessionalDossier()" class="btn-espresso w-full py-6 mt-12 font-black uppercase text-xs tracking-[0.5em]">
            Saƒçuvaj Master Dosije
        </button>
    </div>`;
}

function escapeHtml(text) {
    if (!text) return "";
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function renderEntry(type, data, index) {
    if (type === 'education') {
        return `<div class="p-4 border border-[var(--border)] rounded-xl relative group transition-all">
            <button onclick="removeEntry('education', ${index})" class="absolute -top-2 -right-2 bg-red-500 text-white w-5 h-5 rounded-full text-[10px] opacity-0 group-hover:opacity-100 transition-all shadow-md">√ó</button>
            <div class="flex flex-col md:flex-row gap-4">
                <input type="text" class="dossier-input edu-degree w-full md:w-2/5" value="${escapeHtml(data.degree || '')}" placeholder="Zvanje">
                <input type="text" class="dossier-input edu-school w-full md:w-2/5" value="${escapeHtml(data.school || '')}" placeholder="≈†kola">
                <input type="text" class="dossier-input edu-year w-full md:w-1/5" value="${escapeHtml(data.year || '')}" placeholder="Godina">
            </div>
        </div>`;
    }
    if (type === 'experience') {
        return `<div class="p-4 border border-[var(--border)] rounded-xl space-y-3 relative group">
            <button onclick="removeEntry('experience', ${index})" class="absolute -top-2 -right-2 bg-red-500 text-white w-5 h-5 rounded-full text-[10px] opacity-0 group-hover:opacity-100">√ó</button>
            <div class="grid grid-cols-2 gap-3">
                <input type="text" class="dossier-input exp-role" value="${escapeHtml(data.role || '')}" placeholder="Pozicija">
                <input type="text" class="dossier-input exp-comp" value="${escapeHtml(data.company || '')}" placeholder="Firma">
            </div>
            <input type="text" class="dossier-input exp-period" value="${escapeHtml(data.period || '')}" placeholder="Period">
            <textarea class="dossier-input exp-desc h-20 text-xs" placeholder="Opis">${escapeHtml(data.desc || '')}</textarea>
        </div>`;
    }
    if (type === 'certifications') {
        return `<div class="flex gap-2 group">
            <input type="text" class="dossier-input cert-name flex-grow" value="${escapeHtml(data.name || '')}" placeholder="Naziv">
            <input type="text" class="dossier-input cert-year w-24" value="${escapeHtml(data.year || '')}" placeholder="Godina">
            <button onclick="removeEntry('certifications', ${index})" class="text-red-500 opacity-30 group-hover:opacity-100">√ó</button>
        </div>`;
    }
    return "";
}

// ‚ö†Ô∏è NOVA FUNKCIJA: ƒåuva trenutno stanje DOM-a u masterDossier objekat u letu
function syncFormToDossier() {
    const container = document.getElementById('formContainer');
    if (!container || container.innerHTML.trim() === '') return;

    masterDossier.full_name = document.getElementById('fName')?.value.trim() || "";
    masterDossier.title = document.getElementById('fTitle')?.value.trim() || "";
    masterDossier.email = document.getElementById('fEmail')?.value.trim() || "";
    masterDossier.phone = document.getElementById('fPhone')?.value.trim() || "";
    masterDossier.location = document.getElementById('fLoc')?.value.trim() || "";
    masterDossier.linkedin = document.getElementById('fLinkedin')?.value.trim() || "";
    masterDossier.github = document.getElementById('fGithub')?.value.trim() || "";
    masterDossier.website = document.getElementById('fWebsite')?.value.trim() || "";
    masterDossier.motto = document.getElementById('fMotto')?.value.trim() || "";
    
    masterDossier.education = Array.from(document.querySelectorAll('.edu-degree')).map((el, i) => ({
        degree: el.value.trim(),
        school: document.querySelectorAll('.edu-school')[i]?.value.trim() || "",
        year: document.querySelectorAll('.edu-year')[i]?.value.trim() || ""
    }));
    
    masterDossier.experience = Array.from(document.querySelectorAll('.exp-role')).map((el, i) => ({
        role: el.value.trim(),
        company: document.querySelectorAll('.exp-comp')[i]?.value.trim() || "",
        period: document.querySelectorAll('.exp-period')[i]?.value.trim() || "",
        desc: document.querySelectorAll('.exp-desc')[i]?.value.trim() || ""
    }));
    
    masterDossier.skills = {
        technical: document.getElementById('skillTech')?.value.split(',').map(s => s.trim()).filter(Boolean) || [],
        industry: document.getElementById('skillInd')?.value.split(',').map(s => s.trim()).filter(Boolean) || [],
        soft: document.getElementById('skillSoft')?.value.split(',').map(s => s.trim()).filter(Boolean) || []
    };
    
    masterDossier.certifications = Array.from(document.querySelectorAll('.cert-name')).map((el, i) => ({
        name: el.value.trim(),
        year: document.querySelectorAll('.cert-year')[i]?.value.trim() || ""
    }));
}

function addEntry(type) {
    syncFormToDossier(); // ‚úÖ Prvo saƒçuvaj sve ≈°to je korisnik do sada kucao!
    
    if (!masterDossier[type]) masterDossier[type] = [];
    
    if (type === 'education') masterDossier.education.push({ degree: "", school: "", year: "" });
    if (type === 'experience') masterDossier.experience.push({ role: "", company: "", period: "", desc: "" });
    if (type === 'certifications') masterDossier.certifications.push({ name: "", year: "" });
    
    renderProfessionalForm(); // Zatim iscrtaj formu sa starim tekstom + novim poljem
}

function removeEntry(type, index) {
    syncFormToDossier(); // ‚úÖ Prvo saƒçuvaj sve
    
    if (masterDossier[type] && masterDossier[type].length > index) {
        masterDossier[type].splice(index, 1);
    }
    
    renderProfessionalForm();
}

function saveProfessionalDossier() {
    syncFormToDossier(); // Iskoristimo novu funkciju za oƒçitavanje podataka
    
    // Optimizacija: oƒçisti prazne redove pre snimanja u bazu
    masterDossier.education = masterDossier.education.filter(e => e.degree || e.school);
    masterDossier.experience = masterDossier.experience.filter(e => e.role || e.company);
    masterDossier.certifications = masterDossier.certifications.filter(c => c.name);
    
    localStorage.setItem('cv_espresso_dossier', JSON.stringify(masterDossier));
    
    if (typeof syncDossierToCloud === "function") {
        syncDossierToCloud(masterDossier);
    }
    
    document.getElementById('dossierEditor').classList.add('hidden');
    alert("‚úÖ Saƒçuvano!");
}
--------------------
END OF FILE: static\js\dossier.js

START OF FILE: static\js\main.js
--------------------
let currentLang = 'sr';

// Event Listeners
const langBtn = document.getElementById('langBtn');
const themeToggleBtn = document.getElementById('themeToggle');

if (langBtn) langBtn.addEventListener('click', toggleLang);
if (themeToggleBtn) themeToggleBtn.addEventListener('click', toggleTheme);

// ============================================
// --- A≈ΩURIRANA FUNKCIJA ZA JEZIK ---
// ============================================
function toggleLang() {
    currentLang = currentLang === 'sr' ? 'en' : 'sr';
    if (langBtn) langBtn.innerText = currentLang;
    
    // Promena jezika u Info Modalu (Uputstvu)
    const title = document.getElementById('helpTitle');
    const txtSr = document.getElementById('helpTextSr');
    const txtEn = document.getElementById('helpTextEn');
    
    if (currentLang === 'en') {
        if (title) title.innerText = "How to use?";
        if (txtSr) txtSr.classList.add('hidden');
        if (txtEn) txtEn.classList.remove('hidden');
    } else {
        if (title) title.innerText = "Kako se koristi?";
        if (txtSr) txtSr.classList.remove('hidden');
        if (txtEn) txtEn.classList.add('hidden');
    }
}

function toggleTheme() {
    const html = document.documentElement;
    html.classList.toggle('dark');
    const isDark = html.classList.contains('dark');
    
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    
    if (sunIcon) sunIcon.classList.toggle('hidden', !isDark);
    if (moonIcon) moonIcon.classList.toggle('hidden', isDark);
    
    localStorage.theme = isDark ? 'dark' : 'light';
}

// Inicijalna provera teme pri uƒçitavanju
(function initTheme() {
    const isDarkStored = localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDarkStored) {
        document.documentElement.classList.add('dark');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        if (sunIcon) sunIcon.classList.remove('hidden');
        if (moonIcon) moonIcon.classList.add('hidden');
    }
})();

// ============================================
// --- SIDE DRAWER LOGIKA (FIOKA) ---
// ============================================
const btnMenu = document.getElementById('btnMenu');
const btnCloseMenu = document.getElementById('btnCloseMenu');
const sideDrawer = document.getElementById('sideDrawer');
const drawerBackdrop = document.getElementById('drawerBackdrop');
const drawerOpenDossier = document.getElementById('drawerOpenDossier');

function toggleDrawer() {
    // Ako nema drawera na stranici, prekini izvr≈°avanje
    if (!sideDrawer || !drawerBackdrop) return;

    const isClosed = sideDrawer.classList.contains('-translate-x-full');
    
    if (isClosed) {
        // Otvori drawer
        sideDrawer.classList.remove('-translate-x-full');
        drawerBackdrop.classList.remove('hidden');
        // Kratak delay za glatku animaciju opacity-ja
        setTimeout(() => drawerBackdrop.classList.remove('opacity-0'), 10);
    } else {
        // Zatvori drawer
        sideDrawer.classList.add('-translate-x-full');
        drawerBackdrop.classList.add('opacity-0');
        // Saƒçekaj da se zavr≈°i CSS tranzicija (500ms) pa ga ukloni iz DOM-a
        setTimeout(() => drawerBackdrop.classList.add('hidden'), 500); 
    }
}

// Postavljanje listenara za Drawer dugmiƒáe
if (btnMenu) btnMenu.addEventListener('click', toggleDrawer);
if (btnCloseMenu) btnCloseMenu.addEventListener('click', toggleDrawer);
if (drawerBackdrop) drawerBackdrop.addEventListener('click', toggleDrawer);

// Preusmeravanje klika iz Drawera na otvaranje Master Dosijea
if (drawerOpenDossier) {
    drawerOpenDossier.addEventListener('click', () => {
        toggleDrawer(); // Prvo zatvori fioku
        
        const dossierEditor = document.getElementById('dossierEditor');
        
        // Prikazuje formu ako editor i globalna render funkcija postoje
        if (dossierEditor && typeof renderProfessionalForm === "function") {
            dossierEditor.classList.remove('hidden');
            renderProfessionalForm();
        }
    });
}

// ============================================
// --- HELP MODAL LOGIKA (UPUTSTVO) ---
// ============================================
const btnHelp = document.getElementById('btnHelp');
const helpModal = document.getElementById('helpModal');
const helpBackdrop = document.getElementById('helpBackdrop');
const helpContent = document.getElementById('helpContent');
const btnCloseHelp = document.getElementById('btnCloseHelp');

// Pomoƒána funkcija za otvaranje/zatvaranje
function toggleHelpModal() {
    if (!helpModal || !helpBackdrop || !helpContent) return;

    if (helpModal.classList.contains('hidden')) {
        // Otvaranje
        helpModal.classList.remove('hidden');
        setTimeout(() => {
            helpBackdrop.classList.remove('opacity-0');
            helpContent.classList.remove('opacity-0', 'scale-95');
        }, 10);
    } else {
        // Zatvaranje
        helpBackdrop.classList.add('opacity-0');
        helpContent.classList.add('opacity-0', 'scale-95');
        // Saƒçekaj da se animacija zavr≈°i (300ms)
        setTimeout(() => helpModal.classList.add('hidden'), 300);
    }
}

// Event listeneri za Info prozor
if (btnHelp) btnHelp.addEventListener('click', toggleHelpModal);
if (btnCloseHelp) btnCloseHelp.addEventListener('click', toggleHelpModal);
if (helpBackdrop) helpBackdrop.addEventListener('click', toggleHelpModal);
--------------------
END OF FILE: static\js\main.js

